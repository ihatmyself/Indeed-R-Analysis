---
title: "Indeed-R-Analysis"
output: html_document
date: "2024-01-23"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, echo = FALSE, warning = FALSE)
```

## Libraries

```{r, echo=TRUE}
library(tidyverse)

library(ggplot2)

#install.packages("dplyr")
library(dplyr)

#install.packages("ggrepel")
library(ggrepel)

#install.packages("GGally")
library(GGally)

#install.packages("forcats")
library(forcats)

#install.pacakges("patchwork")
library(patchwork)

#install.packages("readr")
library(readr)  

library(stringr)

library(usethis)

use_git_config(user.name='ihatmyself',user.email='ihatmyselflol@gmail.com')
```

## Read Files

```{r, echo=TRUE}


# 1. List of CSV files
csv_files <- list.files(pattern = "\\.csv$", full.names = TRUE)

# 2. Read CSV files and add a new column with the file name
combined_data <- NULL

for (csv_file in csv_files) {
  file_name <- tools::file_path_sans_ext(basename(csv_file))  # Extract file name without extension
  data <- read.csv(csv_file)
  data$source_file <- file_name  # Add a new column with the file name
  combined_data <- rbind(combined_data, data)
}

```

### Data Cleaning

Delimiting \@ and \# to create job_title, city and date

```{r, echo=TRUE}
combined_data <- transform(combined_data, 
                           Job_title = gsub("@.*", "", source_file),
                           city = gsub(".*@|\\#.*", "", source_file),
                           date = gsub(".*\\#", "", source_file))
```

Salary calculation

```{r, echo=TRUE}

combined_data$Lower_Salary <- NA
combined_data$Upper_Salary <- NA

for (i in 1:nrow(combined_data)) {
  if (str_detect(combined_data$salary[i], "year")) {
  
    split <- as.numeric(gsub(",","",gsub("[^0-9,]", "", unlist(strsplit(combined_data$salary[i], " - ")))))
    
    combined_data$Lower_Salary[i] <- split[1]
    combined_data$Upper_Salary[i] <- split[2]
  }
  if (str_detect(combined_data$salary[i], "month")) {
  
    split <- as.numeric(gsub(",","",gsub("[^0-9,]", "", unlist(strsplit(combined_data$salary[i], " - ")))))
    
    combined_data$Lower_Salary[i] <- split[1]*12
    combined_data$Upper_Salary[i] <- split[2]*12
  }
  if (str_detect(combined_data$salary[i], "hour")) {
  
    split <- as.numeric(gsub(",","",gsub("[^0-9,]", "", unlist(strsplit(combined_data$salary[i], " - ")))))
    
    combined_data$Lower_Salary[i] <- split[1]*260*8
    combined_data$Upper_Salary[i] <- split[2]*260*8
  }
  
  combined_data$Upper_Salary[is.na(combined_data$Upper_Salary)] <- combined_data$Lower_Salary[is.na(combined_data$Upper_Salary)]
}

#create an average salary column
combined_data <- combined_data %>%
  mutate(Average_Salary = (Lower_Salary + Upper_Salary) / 2)

```

### Salary analysis comparing cities

Mean Salary by City

```{r, echo=TRUE}

summary_by_city <- combined_data %>%
  group_by(city) %>%
  summarize(
    Mean_Salary = mean(Average_Salary, na.rm = TRUE),
    Median_Salary = median(Average_Salary, na.rm = TRUE),
    Min_Salary = min(Average_Salary, na.rm = TRUE),
    Max_Salary = max(Average_Salary, na.rm = TRUE),
    Count = n()
  )

ggplot(summary_by_city, aes(x = city, y = Mean_Salary/1000)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(title = "Mean Salary by City", x = "City", y = "Mean Salary (thousands)")+ 
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

Boxplots of Salary by City

```{r, echo=TRUE}

ggplot(combined_data, aes(x = city, y = Average_Salary/1000)) +
  geom_boxplot(fill = "orange", color = "black", outlier.shape = NA) +
  labs(title = "Boxplot of Salary by City", x = "City", y = "Salary (thousands)")+ 
  coord_cartesian(ylim = c(0, 300))+ 
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r, echo=TRUE}

us_map <- map_data("usa")

# Sample dataset of US cities
us_cities <- data.frame(
  city = c("austin", "chicago", "houston", "los_angeles", "new_york","dallas", "philadelphia", "phoenix", "san_antonio", "san_diego"),
  lon = c(-97.7431, -87.6298, -95.3698, -118.2437, -74.006,-96.797,-75.1652, -112.0740, -98.4946, -117.1611),
  lat = c(30.2672, 41.8781, 29.7604, 34.0522, 40.7128,32.7767, 39.9626, 33.4484, 29.4252,32.7157)
)

# Create a map of US cities
ggplot() +
  geom_polygon(data = us_map, aes(x = long, y = lat, group = group), fill = "white", color = "black") +
  geom_point(data = us_cities, aes(x = lon, y = lat), size = 3, color = "green") +
  labs(title = "US Cities Map") +
  theme_void()

```

### Job titles and Salary

```{r,echo=TRUE}


ggplot(combined_data, aes(x = Job_title, y = Average_Salary/1000)) +
  geom_boxplot(fill = "darkgreen", color = "black", outlier.shape = NA) +
  labs(title = "Boxplot of Salary by Job Title", x = "Job Title", y = "Mean Average Salary (thousands)")+ 
  coord_cartesian(ylim = c(0, 300))+ 
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
